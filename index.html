<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­ç›Ÿäºæ´²ç§»æ°‘å¸‚å ´äº’å‹•å„€è¡¨æ¿</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f8fafc; /* slate-50 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 40vh;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        /* é‡å°æ¯”è¼ƒåœ–è¡¨èª¿æ•´é«˜åº¦ */
        .comparison-chart-container {
            position: relative;
            width: 100%;
            max-width: 900px; /* å¢åŠ æœ€å¤§å¯¬åº¦ */
            margin-left: auto;
            margin-right: auto;
            height: 500px; /* å›ºå®šé«˜åº¦ */
            max-height: 60vh;
        }

        .main-title {
            background: linear-gradient(to right, #4f46e5, #9333ea);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8">
        
        <header class="text-center mb-8">
            <div class="flex flex-col items-center justify-center mb-4">
                <!-- LOGO åœ–ç‰‡å·²èª¿æ•´ç‚ºæ›´å…·éŸ¿æ‡‰æ€§ï¼Œä¸¦å¢åŠ ä¸Šé‚Šè·ä»¥èˆ‡æ¨™é¡Œæ‹‰é–‹ç©ºé–“ -->
                <img src="https://www.weichuanusa.com/wp-content/uploads/2024/02/Logo.svg" onerror="this.src='https://placehold.co/100x100/transparent/transparent?text=Company+Logo'" alt="Company Logo" class="max-h-72 w-auto mb-8 rounded-xl">
                <h1 class="text-4xl md:text-5xl font-bold main-title">æ­ç›Ÿ+è‹±åœ‹åœ°å€ï¼Œäºæ´²ç§»æ°‘å¸‚å ´åœ–è¡¨</h1>
            </div>
            <!-- ç¸®å°äº†èˆ‡æ¨™é¡Œä¹‹é–“çš„ç©ºéš™ (mt-1) -->
            <p class="mt-1 text-lg text-slate-600">æ·±å…¥æ¢ç´¢æ­ç›Ÿå„åœ‹çš„äºæ´²ç¤¾ç¾¤æ¦‚æ³ã€å¸‚å ´ç¾æ³èˆ‡é£²é£Ÿæ–‡åŒ–</p>
        </header>

        <section id="main-dashboard" class="bg-white p-6 rounded-2xl shadow-lg">
            <div class="mb-6">
                <h2 class="text-2xl font-bold text-slate-700 mb-2">æ¢ç´¢å„åœ‹æ•¸æ“š (ä¾ç§»æ°‘æ•¸é‡æ’åº)</h2>
                <!-- ä¸‹æ‹‰å¼é¸å–®èªªæ˜å·²æ›´æ–° -->
                <p class="text-slate-500 mb-4">è«‹å¾ä¸‹æ‹‰é¸å–®ä¸­é¸æ“‡ä¸€å€‹åœ‹å®¶ï¼Œä¸‹æ–¹çš„åœ–è¡¨å’Œè³‡è¨Šå°‡æœƒå³æ™‚æ›´æ–°ã€‚</p>
                <select id="country-selector" class="w-full md:w-1/3 bg-slate-100 border-2 border-slate-200 rounded-lg p-3 text-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition"></select>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                
                <div id="profile-card" class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                    <h3 class="text-xl font-bold text-indigo-700 mb-4 flex items-center">
                        <span class="mr-2">ğŸŒ</span>åœ‹å®¶æ¦‚æ³
                    </h3>
                    <div id="profile-content" class="space-y-3 text-slate-700">
                        <!-- Content will be dynamically loaded here -->
                    </div>
                </div>

                <div id="supermarket-card" class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                    <h3 class="text-xl font-bold text-indigo-700 mb-4 flex items-center">
                        <span class="mr-2">ğŸ›’</span>ä¸»æµäºè¶…/ä¸»è¦åŸå¸‚æ•¸é‡èˆ‡æ‰¹ç™¼å•†
                    </h3>
                    <div id="supermarket-content" class="space-y-3 text-slate-700">
                        <!-- Content will be dynamically loaded here -->
                    </div>
                </div>

                <div class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                    <h3 class="text-xl font-bold text-indigo-700 mb-4 text-center">ç§»æ°‘ä¸»è¦ä¾†æºåœ‹ä½”æ¯”</h3>
                    <div class="chart-container">
                        <canvas id="immigrant-origin-chart"></canvas>
                    </div>
                </div>

                <div class="bg-slate-50 p-6 rounded-xl border border-slate-200">
                    <h3 class="text-xl font-bold text-indigo-700 mb-4 text-center">äºæ´²é¤å»³æ•¸é‡åˆ†ä½ˆ</h3>
                    <div class="chart-container">
                        <canvas id="restaurant-chart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <section id="comparison-section" class="mt-8 bg-white p-6 rounded-2xl shadow-lg">
             <h2 class="text-2xl font-bold text-slate-700 mb-2">å„åœ‹äºæ´²ç§»æ°‘æ¯”ä¾‹ç¸½è¦½</h2>
             <p class="mt-4 text-slate-500 mb-4">æ­¤åœ–è¡¨å±•ç¤ºäº†å ±å‘Šä¸­æ‰€æœ‰åœ‹å®¶çš„äºæ´²ç§»æ°‘ä½”ç¸½äººå£çš„æ¯”ä¾‹ï¼Œå…¶ä¸­è‹±åœ‹æ•¸æ“šå›ºå®šé¡¯ç¤ºåœ¨æœ€å¾Œï¼Œè®“æ‚¨èƒ½å¤ å¿«é€Ÿé€²è¡Œæ©«å‘æ¯”è¼ƒã€‚</p>
            <div class="comparison-chart-container">
                <canvas id="comparison-chart"></canvas>
            </div>
        </section>

        <!-- æ–°å¢çš„å„åœ‹äºæ´²è¶…å¸‚æ•¸é‡ç¸½è¦½åœ–è¡¨å€åŸŸ -->
        <section id="supermarket-comparison-section" class="mt-8 bg-white p-6 rounded-2xl shadow-lg">
             <h2 class="text-2xl font-bold text-slate-700 mb-2">å„åœ‹äºæ´²è¶…å¸‚æ•¸é‡ç¸½è¦½</h2>
             <p class="mt-4 text-slate-500 mb-4">æ­¤åœ–è¡¨å±•ç¤ºäº†å ±å‘Šä¸­æ‰€æœ‰åœ‹å®¶äºæ´²è¶…å¸‚çš„ä¼°è¨ˆç¸½æ•¸ï¼Œå…¶ä¸­è‹±åœ‹æ•¸æ“šå›ºå®šé¡¯ç¤ºåœ¨æœ€å¾Œï¼Œè®“æ‚¨èƒ½å¤ å¿«é€Ÿé€²è¡Œæ©«å‘æ¯”è¼ƒã€‚</p>
            <div class="comparison-chart-container">
                <canvas id="supermarket-comparison-chart"></canvas>
            </div>
        </section>

        <!-- åŸæœ‰çš„å„åœ‹äºæ´²é¤å»³æ•¸é‡ç¸½è¦½åœ–è¡¨å€åŸŸ -->
        <section id="restaurant-comparison-section" class="mt-8 bg-white p-6 rounded-2xl shadow-lg">
             <h2 class="text-2xl font-bold text-slate-700 mb-2">å„åœ‹äºæ´²é¤å»³æ•¸é‡ç¸½è¦½</h2>
             <p class="mt-4 text-slate-500 mb-4">æ­¤åœ–è¡¨å±•ç¤ºäº†å ±å‘Šä¸­æ‰€æœ‰åœ‹å®¶äºæ´²é¤å»³çš„ä¼°è¨ˆç¸½æ•¸ï¼Œå…¶ä¸­è‹±åœ‹æ•¸æ“šå›ºå®šé¡¯ç¤ºåœ¨æœ€å¾Œï¼Œè®“æ‚¨èƒ½å¤ å¿«é€Ÿé€²è¡Œæ©«å‘æ¯”è¼ƒã€‚</p>
            <div class="comparison-chart-container">
                <canvas id="restaurant-comparison-chart"></canvas>
            </div>
        </section>

        <!-- åŸæœ‰çš„å„åœ‹äºæ´²é£Ÿå“æ‰¹ç™¼ç¸½æ•¸åœ–è¡¨å€åŸŸ -->
        <section id="wholesaler-comparison-section" class="mt-8 bg-white p-6 rounded-2xl shadow-lg">
             <h2 class="text-2xl font-bold text-slate-700 mb-2">å„åœ‹äºæ´²é£Ÿå“æ‰¹ç™¼ç¸½æ•¸ç¸½è¦½</h2>
             <p class="mt-4 text-slate-500 mb-4">æ­¤åœ–è¡¨å±•ç¤ºäº†å ±å‘Šä¸­æ‰€æœ‰åœ‹å®¶äºæ´²é£Ÿå“æ‰¹ç™¼å•†çš„ä¼°è¨ˆç¸½æ•¸ï¼Œå…¶ä¸­è‹±åœ‹æ•¸æ“šå›ºå®šé¡¯ç¤ºåœ¨æœ€å¾Œï¼Œè®“æ‚¨èƒ½å¤ å¿«é€Ÿé€²è¡Œæ©«å‘æ¯”è¼ƒã€‚</p>
            <div class="comparison-chart-container">
                <canvas id="wholesaler-comparison-chart"></canvas>
            </div>
        </section>

    </div>

    <footer class="text-center p-4 mt-8 text-sm text-slate-500">
        <p>æ•¸æ“šä¾†æºï¼šæ­ç›Ÿäºæ´²ç§»æ°‘-è¶…å¸‚-é¤å»³æ•¸é‡æ¦‚æ³å ±å‘Šã€‚åœ–è¡¨èˆ‡æ•¸æ“šåƒ…ä¾›åƒè€ƒã€‚</p>
    </footer>

    <script>
        const reportData = [
            { country: "å¾·åœ‹", totalPop: 83.78, immigrantPop: 5.44, immigrantRatio: 6.5, sources: "åœŸè€³å…¶ (2.1%), ä¸­åœ‹ (1.2%), è¶Šå— (0.9%), å…¶ä»– (2.3%), å°ç£(<0.05%)", characteristics: "è¥¿æ­ï¼Œå·¥æ¥­ä¸­å¿ƒï¼›é£²é£Ÿä»¥è‚‰é¡å’Œé¦¬éˆ´è–¯ç‚ºä¸»ï¼Œå¦‚å¾·åœ‹é¦™è…¸ã€è±¬è…³ã€‚å•¤é…’æ–‡åŒ–ç››è¡Œã€‚", supermarkets: ["æ±æ–¹è¶…å¸‚Go Asia (ç´„63é–“é–€å¸‚)", "Vinhâ€‘Loi Asien Supermarkt (ç´„5é–“é–€å¸‚)", "Eurumart (éŸ“å¼ç¶²è³¼åˆ°åºœé…é€)", "Ochamaäº¬æ± (ç¶²è³¼åˆ°åºœé…é€)", "æŸæ—ï¼Œç´„95é–“", "æ…•å°¼é»‘ï¼Œç´„48é–“", "æ¼¢å ¡ï¼Œç´„33é–“", "æ³•è˜­å…‹ç¦ï¼Œç´„28é–“"], wholesalers: ["JFC", "DeLong GmbH", "Transfood GmbH"], totalWholesalers: 20, manualSupermarketCount: 208, restaurants: { "ä¸­é¤": [4000, 6000], "äºæ´²è‡ªåŠ©é¤": [1000, 1500], "æ—¥æœ¬é¤": [2000, 3000], "æ³°åœ‹é¤": [1000, 1500], "è¶Šå—é¤": [1000, 1500], "å…¶ä»–": [800, 1200] } },
            { country: "æ³•åœ‹", totalPop: 65.27, immigrantPop: 4.57, immigrantRatio: 7.0, sources: "è¶Šå— (1.8%), ä¸­åœ‹ (0.8%), æŸ¬/è€ (1.2%), å…¶ä»– (3.2%), å°ç£(<0.05%)", characteristics: "è¥¿æ­ï¼Œå‰æ®–æ°‘åœ°èƒŒæ™¯ï¼›é£²é£Ÿç²¾ç·»ï¼Œæ³¨é‡é£Ÿæå“è³ªå’Œçƒ¹é£ªæŠ€å·§ï¼Œå¦‚éµè‚ã€é¦¬å¡é¾ã€‚", supermarkets: ["é™³æ°å…„å¼Ÿè¶…å¸‚ Tang FrÃ¨res (ç´„22é–“é–€å¸‚)", "Paris Store (ç´„21é–“é–€å¸‚)", "Le CarrÃ© Asian (ç¶²è³¼åˆ°åºœé…é€)", "Ochamaäº¬æ± (ç¶²è³¼åˆ°åºœé…é€)", "å·´é»ï¼Œç´„116é–“", "é‡Œæ˜‚ï¼Œç´„15é–“"], wholesalers: ["NOS AMIS", "Foodex (åŸ Asia Food Import)"], totalWholesalers: 15, manualSupermarketCount: 131, restaurants: { "ä¸­é¤": [3000, 4000], "äºæ´²è‡ªåŠ©é¤": [500, 800], "æ—¥æœ¬é¤": [2000, 3000], "æ³°åœ‹é¤": [800, 1200], "è¶Šå—é¤": [800, 1200], "å…¶ä»–": [300, 600] } },
            { country: "ç¾©å¤§åˆ©", totalPop: 60.46, immigrantPop: 2.54, immigrantRatio: 4.2, sources: "è²å¾‹è³“ (1.1%), ä¸­åœ‹ (0.9%), å°åº¦ (0.7%), å…¶ä»– (1.5%), å°ç£(<0.1%)", characteristics: "å—æ­ï¼Œè£½é€ æ¥­å¯†é›†ï¼›é£²é£Ÿä»¥éºµé£Ÿå’ŒæŠ«è–©ç‚ºä¸»ï¼Œå¦‚ç¾©å¤§åˆ©éºµã€ææ‹‰ç±³è˜‡ã€‚", supermarkets: ["ç±³è˜­ï¼Œç´„45é–“", "ç¾…é¦¬ï¼Œç´„30é–“", "Kathay.it (ç¶²è³¼åˆ°åºœé…é€)", "8TTO MARKET (ç¶²è³¼åˆ°åºœé…é€)"], wholesalers: ["Asiantrade S.r.l.", "Union Trade S.r.l.", "Todayfood (Ingrosso Alimentare Asiatico)"], totalWholesalers: 12, restaurants: { "ä¸­é¤": [3000, 4000], "äºæ´²è‡ªåŠ©é¤": [600, 1000], "æ—¥æœ¬é¤": [2500, 3500], "æ³°åœ‹é¤": [200, 400], "è¶Šå—é¤": [100, 200], "å…¶ä»–": [300, 600] } },
            { country: "è¥¿ç­ç‰™", totalPop: 46.75, immigrantPop: 1.64, immigrantRatio: 3.5, sources: "ä¸­åœ‹ (1.1%), è²å¾‹è³“ (1.0%), å·´åŸºæ–¯å¦ (0.6%), å…¶ä»– (0.8%), å°ç£(<0.1%)", characteristics: "å—æ­ï¼Œæœå‹™æ¥­ä¸»å°ï¼›é£²é£Ÿè±å¯Œå¤šæ¨£ï¼Œæµ·é®®å’Œè‚‰é¡èœé¤šå±…å¤šï¼Œå¦‚è¥¿ç­ç‰™æµ·é®®ç‡‰é£¯ã€Tapasã€‚", supermarkets: ["å·´å¡éš†ç´ï¼Œç´„50é–“", "é¦¬å¾·é‡Œï¼Œç´„45é–“", "Oriental Mart (ç¶²è³¼åˆ°åºœé…é€)", "å¤©å¤©è³¼äºæ´²é£Ÿå“è¶…å¸‚ (ç¶²è³¼åˆ°åºœé…é€)"], wholesalers: ["EMB FOOD", "Asia Food Express", "Union Alimentaria"], totalWholesalers: 10, restaurants: { "ä¸­é¤": [2500, 3500], "äºæ´²è‡ªåŠ©é¤": [500, 800], "æ—¥æœ¬é¤": [3000, 4000], "æ³°åœ‹é¤": [400, 600], "è¶Šå—é¤": [100, 200], "å…¶ä»–": [300, 500] } },
            { country: "è·è˜­", totalPop: 17.13, immigrantPop: 1.37, immigrantRatio: 8.0, sources: "åœŸè€³å…¶ (2.3%), å°å°¼ (1.5%), ä¸­åœ‹ (0.7%), å…¶ä»– (3.5%), å°ç£(<0.05%)", characteristics: "è¥¿æ­ï¼Œè²¿æ˜“æ¨ç´ï¼›é£²é£Ÿç°¡æ¨¸ï¼Œä»¥ä¹³è£½å“å’Œè”¬èœç‚ºä¸»ï¼Œå¦‚è·è˜­é¬†é¤…ã€ä¹³é…ªã€‚", supermarkets: ["Amazing Oriental (ç´„25é–“é–€å¸‚)", "Ochamaäº¬æ± (ç¶²è³¼åˆ°åºœé…é€)", "Asia Express Food (ç¶²è³¼åˆ°åºœé…é€)", "é˜¿å§†æ–¯ç‰¹ä¸¹ï¼Œç´„25é–“", "æµ·ç‰™ï¼Œç´„13é–“"], wholesalers: ["Amazing Oriental Wholesale", "Asia Express Food B.V.", "Lucky Oriental Food"], totalWholesalers: 10, manualSupermarketCount: 55, restaurants: { "ä¸­é¤": [1500, 2000], "äºæ´²è‡ªåŠ©é¤": [400, 600], "æ—¥æœ¬é¤": [1000, 1300], "å°å°¼é¤": [500, 800], "æ³°åœ‹é¤": [300, 500], "è¶Šå—é¤": [80, 150], "å…¶ä»–": [200, 400] } },
            { country: "ç‘å…¸", totalPop: 10.10, immigrantPop: 0.61, immigrantRatio: 6.0, sources: "æ•˜åˆ©äº/ä¼Šæ‹‰å…‹ (3.2%), ä¸­åœ‹ (0.5%), æ³°åœ‹ (0.4%), å…¶ä»– (1.9%), å°ç£(<0.05%)", characteristics: "åŒ—æ­ï¼Œé›£æ°‘æ¥æ”¶åœ‹ï¼›é£²é£Ÿä»¥é­šé¡ã€è‚‰ä¸¸å’Œæ¼¿æœç‚ºä¸»ï¼Œå¦‚ç‘å…¸è‚‰ä¸¸ã€é¯¡é­šã€‚", supermarkets: ["è˜‡é»ä¸–ï¼Œç´„19é–“", "æ´›æ¡‘ï¼Œç´„17é–“", "æ—¥å…§ç“¦ï¼Œç´„15é–“", "Asia Markt (ç¶²è³¼åˆ°åºœé…é€)"], wholesalers: ["Oriental Foods AB", "Svenska Orient Livsmedel", "Asia Trade Sweden"], totalWholesalers: 7, restaurants: { "ä¸­é¤": [600, 800], "äºæ´²è‡ªåŠ©é¤": [300, 500], "æ—¥æœ¬é¤": [800, 1000], "æ³°åœ‹é¤": [400, 600], "è¶Šå—é¤": [50, 150], "å…¶ä»–": [400, 600] } },
            { country: "æ¯”åˆ©æ™‚", totalPop: 11.59, immigrantPop: 0.58, immigrantRatio: 5.0, sources: "åœŸè€³å…¶ (1.8%), å°åº¦ (0.9%), ä¸­åœ‹ (0.6%), å…¶ä»– (1.7%), å°ç£(<0.05%)", characteristics: "è¥¿æ­ï¼Œæ­ç›Ÿç¸½éƒ¨æ‰€åœ¨ï¼›é£²é£Ÿä»¥è–¯æ¢ã€å·§å…‹åŠ›å’Œå•¤é…’èåï¼Œå¦‚æ¯”åˆ©æ™‚è–¯æ¢ã€è¯å¤«é¤…ã€‚", supermarkets: ["å¸ƒé­¯å¡çˆ¾ï¼Œç´„25é–“", "å®‰ç‰¹è¡›æ™®ï¼Œç´„17é–“", "Ochamaäº¬æ± (ç¶²è³¼åˆ°åºœé…é€)"], wholesalers: ["FoodAsia Belgium", "Kam Yuen", "Oriental Food Express"], totalWholesalers: 7, restaurants: { "ä¸­é¤": [1500, 2000], "äºæ´²è‡ªåŠ©é¤": [300, 500], "æ—¥æœ¬é¤": [800, 1200], "æ³°åœ‹é¤": [300, 500], "è¶Šå—é¤": [200, 400], "å…¶ä»–": [200, 400] } },
            { country: "å¥§åœ°åˆ©", totalPop: 9.01, immigrantPop: 0.50, immigrantRatio: 5.5, sources: "åœŸè€³å…¶(2.5%), æ•˜åˆ©äº (1.2%), ä¸­åœ‹ (0.4%), å…¶ä»– (1.4%), å°ç£(<0.05%)", characteristics: "ä¸­æ­ï¼Œé›£æ°‘æ¯”ä¾‹é«˜ï¼›é£²é£Ÿä»¥ç³•é»å’Œè‚‰é¡èœé¤šç‚ºä¸»ï¼Œå¦‚ç¶­ä¹Ÿç´ç‚¸è‚‰æ’ã€è–©èµ«è›‹ç³•ã€‚", supermarkets: ["ç¶­ä¹Ÿç´ï¼Œç´„45é–“"], wholesalers: ["ATCO", "Asia Food Express Austria", "Oriental Markt Wien"], totalWholesalers: 6, restaurants: { "ä¸­é¤": [800, 1200], "äºæ´²è‡ªåŠ©é¤": [200, 400], "æ—¥æœ¬é¤": [500, 800], "æ³°åœ‹é¤": [250, 350], "è¶Šå—é¤": [150, 250], "å…¶ä»–": [200, 350] } },
            { country: "æ³¢è˜­", totalPop: 37.85, immigrantPop: 0.30, immigrantRatio: 0.8, sources: "è¶Šå— (0.4%), ä¸­åœ‹ (0.2%), å…¶ä»– (0.2%), å°ç£(<0.05%)", characteristics: "æ±æ­ï¼Œæ–°èˆˆç§»æ°‘åœ°ï¼›é£²é£Ÿä»¥é¤ƒå­ã€æ¹¯å’Œè‚‰é¡ç‚ºä¸»ï¼Œå¦‚æ³¢è˜­é¤ƒå­ã€ç¾…å®‹æ¹¯ã€‚", supermarkets: ["è¯æ²™ï¼Œç´„20é–“"], wholesalers: ["World of Asia", "Asia Foods Poland", "Oriental Market Poland"], totalWholesalers: 6, restaurants: { "ä¸­é¤": [800, 1200], "äºæ´²è‡ªåŠ©é¤": [200, 400], "æ—¥æœ¬é¤": [700, 1000], "æ³°åœ‹é¤": [200, 350], "è¶Šå—é¤": [200, 350], "å…¶ä»–": [150, 300] } },
            { country: "è‘¡è„ç‰™", totalPop: 10.27, immigrantPop: 0.26, immigrantRatio: 2.5, sources: "å°åº¦ (0.8%), ä¸­åœ‹ (0.6%), å­ŸåŠ æ‹‰ (0.5%), å…¶ä»– (0.6%), å°ç£(<0.05%)", characteristics: "å—æ­ï¼Œè‘¡èªç§»æ°‘èˆ‡è²¿æ˜“ä¸­æ¨ï¼›é£²é£Ÿä»¥æµ·é®®å’Œè›‹æ’»èåï¼Œå¦‚è‘¡å¼è›‹æ’»ã€çƒ¤æ²™ä¸é­šã€‚", supermarkets: ["é‡Œæ–¯æœ¬ï¼Œ 20é–“", "æ³¢çˆ¾åœ–ï¼Œ10é–“"], wholesalers: ["Oriental Foods Portugal", "Asia Market Portugal"], totalWholesalers: 4, restaurants: { "ä¸­é¤": [200, 400], "äºæ´²è‡ªåŠ©é¤": [80, 150], "æ—¥æœ¬é¤": [250, 450], "æ³°åœ‹é¤": [80, 150], "è¶Šå—é¤": [50, 100], "å…¶ä»–": [80, 150] } },
            { country: "ä¸¹éº¥", totalPop: 5.79, immigrantPop: 0.24, immigrantRatio: 4.2, sources: "åœŸè€³å…¶ (1.0%), å·´åŸºæ–¯å¦ (0.9%), ä¸­åœ‹ (0.4%), å…¶ä»– (1.9%), å°ç£(<0.05%)", characteristics: "åŒ—æ­ï¼Œå‹å·¥èˆ‡é›£æ°‘ä¸¦å­˜ï¼›é£²é£Ÿä»¥é–‹æ”¾å¼ä¸‰æ˜æ²»å’Œç³•é»ç‚ºä¸»ï¼Œå¦‚ä¸¹éº¥é…¥ã€‚", supermarkets: ["å“¥æœ¬å“ˆæ ¹ï¼Œç´„46é–“"], wholesalers: ["Asian Food Supply A/S", "Oriental Food Denmark"], totalWholesalers: 4, restaurants: { "ä¸­é¤": [300, 500], "äºæ´²è‡ªåŠ©é¤": [100, 200], "æ—¥æœ¬é¤": [300, 500], "æ³°åœ‹é¤": [150, 250], "è¶Šå—é¤": [50, 100], "å…¶ä»–": [100, 200] } },
            { country: "å¸Œè‡˜", totalPop: 10.46, immigrantPop: 0.21, immigrantRatio: 2.0, sources: "å·´åŸºæ–¯å¦ (0.8%), å­ŸåŠ æ‹‰ (0.6%), ä¸­åœ‹ (0.3%), å…¶ä»– (0.3%), å°ç£(<0.05%)", characteristics: "å—æ­ï¼Œäºæ´²ç§»æ°‘é€æ¼¸å¢åŠ ï¼›é£²é£Ÿä»¥åœ°ä¸­æµ·é¢¨å‘³ç‚ºä¸»ï¼Œå¦‚å¸Œè‡˜æ²™æ‹‰ã€çƒ¤è‚‰ä¸²ã€‚", supermarkets: ["é›…å…¸ï¼Œç´„10â€“12é–“"], wholesalers: ["Asiana Ltd", "Oriental Foods Greece"], totalWholesalers: 4, restaurants: { "ä¸­é¤": [200, 350], "äºæ´²è‡ªåŠ©é¤": [50, 100], "æ—¥æœ¬é¤": [150, 250], "æ³°åœ‹é¤": [80, 150], "è¶Šå—é¤": [20, 50], "å…¶ä»–": [50, 100] } },
            { country: "æ·å…‹", totalPop: 10.69, immigrantPop: 0.21, immigrantRatio: 2.0, sources: "è¶Šå— (1.4%), ä¸­åœ‹ (0.3%), å…¶ä»– (0.3%), å°ç£(<0.05%)", characteristics: "ä¸­æ­ï¼Œè¶Šå—ç¤¾ç¾¤å¤šï¼›é£²é£Ÿä»¥çƒ¤è‚‰å’Œç‡‰èœç‚ºä¸»ï¼Œå¦‚çƒ¤è±¬è‚˜ã€æ·å…‹é¤ƒå­ã€‚", supermarkets: ["å¸ƒæ‹‰æ ¼ï¼Œç´„25é–“"], wholesalers: ["Shin s.r.o. (Shinfood)", "Asia Food CZ"], totalWholesalers: 4, restaurants: { "ä¸­é¤": [250, 400], "äºæ´²è‡ªåŠ©é¤": [80, 150], "æ—¥æœ¬é¤": [200, 350], "æ³°åœ‹é¤": [80, 150], "è¶Šå—é¤": [200, 350], "å…¶ä»–": [50, 100] } },
            { country: "æ„›çˆ¾è˜­", totalPop: 5.03, immigrantPop: 0.20, immigrantRatio: 4.0, sources: "å°åº¦ (1.5%), è²å¾‹è³“ (1.0%), ä¸­åœ‹ (0.5%), å…¶ä»– (1.0%), å°ç£(<0.05%)", characteristics: "è¥¿æ­ï¼Œç§‘æŠ€èˆ‡é†«ç™‚å°å‘ï¼›é£²é£Ÿä»¥ç‡‰èœå’Œé¦¬éˆ´è–¯ç‚ºä¸»ï¼Œå¦‚æ„›çˆ¾è˜­ç‡‰è‚‰ã€è–¯æ³¥ã€‚", supermarkets: ["ç§‘å…‹ï¼Œç´„12é–“", "éƒ½æŸæ—ï¼Œç´„7é–“"], wholesalers: ["Manning Impex", "Oriental Food Ireland"], totalWholesalers: 4, restaurants: { "ä¸­é¤": [300, 500], "äºæ´²è‡ªåŠ©é¤": [80, 150], "æ—¥æœ¬é¤": [250, 400], "æ³°åœ‹é¤": [150, 250], "è¶Šå—é¤": [30, 80], "å…¶ä»–": [80, 150] } },
            { country: "åŒˆç‰™åˆ©", totalPop: 9.66, immigrantPop: 0.12, immigrantRatio: 1.2, sources: "ä¸­åœ‹ (0.5%), è¶Šå— (0.3%), å…¶ä»– (0.4%), å°ç£(<0.05%)", characteristics: "æ±æ­ï¼ŒæŠ•è³‡ç§»æ°‘ï¼›é£²é£Ÿä»¥ç‡‰è‚‰å’Œè¾£å‘³èœé¤šç‚ºä¸»ï¼Œå¦‚åŒˆç‰™åˆ©ç‡‰ç‰›è‚‰ã€‚", supermarkets: ["å¸ƒé”ä½©æ–¯ï¼Œç´„20é–“"], wholesalers: ["Asia Food Hungary", "Oriental Market Hungary"], totalWholesalers: 3, restaurants: { "ä¸­é¤": [200, 350], "äºæ´²è‡ªåŠ©é¤": [50, 100], "æ—¥æœ¬é¤": [150, 250], "æ³°åœ‹é¤": [80, 150], "è¶Šå—é¤": [80, 150], "å…¶ä»–": [50, 100] } },
            { country: "èŠ¬è˜­", totalPop: 5.56, immigrantPop: 0.11, immigrantRatio: 2.0, sources: "ä¸­åœ‹ (0.5%), ä¼Šæ‹‰å…‹/æ•˜åˆ©äº (1.1%), å…¶ä»– (0.4%), å°ç£(<0.05%)", characteristics: "åŒ—æ­ï¼Œç§‘æŠ€èˆ‡ç¤¾æœƒç¦ç¥‰åœ‹ï¼›é£²é£Ÿä»¥é­šé¡å’Œæ¼¿æœç‚ºä¸»ï¼Œå¦‚å¡ç´¯åˆ©é˜¿æ´¾ã€‚", supermarkets: ["èµ«çˆ¾è¾›åŸºï¼Œç´„15é–“"], wholesalers: ["Oy Golden Crop Ab Asian Market", "Oriental Food Finland"], totalWholesalers: 3, restaurants: { "ä¸­é¤": [150, 250], "äºæ´²è‡ªåŠ©é¤": [50, 100], "æ—¥æœ¬é¤": [150, 250], "æ³°åœ‹é¤": [80, 150], "è¶Šå—é¤": [30, 80], "å…¶ä»–": [50, 100] } },
            { country: "ç›§æ£®å ¡", totalPop: 0.67, immigrantPop: 0.04, immigrantRatio: 5.5, sources: "ä¸­åœ‹ (1.0%), å°åº¦ (1.2%), å…¶ä»– (3.3%), å°ç£(<0.05%)", characteristics: "è¥¿æ­ï¼Œå°åœ‹é«˜æ”¶å…¥ï¼›é£²é£Ÿå—æ³•ã€å¾·å½±éŸ¿ï¼Œå¦‚ç›§æ£®å ¡é¦™è…¸ã€‚", supermarkets: ["ç›§æ£®å ¡å¸‚ï¼Œç´„5é–“"], wholesalers: ["Asia Market Luxembourg"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [50, 100], "äºæ´²è‡ªåŠ©é¤": [20, 40], "æ—¥æœ¬é¤": [30, 60], "æ³°åœ‹é¤": [20, 40], "è¶Šå—é¤": [10, 20], "å…¶ä»–": [10, 20] } },
            { country: "é¦¬çˆ¾ä»–", totalPop: 0.52, immigrantPop: 0.02, immigrantRatio: 4.5, sources: "å°åº¦ (2.0%), è²å¾‹è³“ (1.0%), å…¶ä»– (1.5%), å°ç£(<0.05%)", characteristics: "åœ°ä¸­æµ·å³¶åœ‹ï¼Œè‹±èªæ™®åŠï¼›é£²é£Ÿèåˆåœ°ä¸­æµ·é¢¨å‘³ï¼Œå¦‚å…”è‚‰ç‡‰èœã€Pastizziã€‚", supermarkets: ["ç“¦èŠå¡”ï¼Œç´„6é–“"], wholesalers: ["Oriental Food Malta"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [20, 40], "äºæ´²è‡ªåŠ©é¤": [10, 20], "æ—¥æœ¬é¤": [15, 30], "æ³°åœ‹é¤": [10, 20], "è¶Šå—é¤": [5, 10], "å…¶ä»–": [5, 10] } },
            { country: "æ–¯æ´›ç¶­å°¼äº", totalPop: 2.11, immigrantPop: 0.02, immigrantRatio: 0.8, sources: "ä¸­åœ‹ (0.3%), å°åº¦/å…¶ä»– (0.5%), å°ç£(<0.05%)", characteristics: "ä¸­æ­ï¼Œå•†è²¿äº¤æµé»ï¼›é£²é£Ÿå—å¥§åœ°åˆ©å’Œç¾©å¤§åˆ©å½±éŸ¿ï¼Œå¦‚é¦™è…¸ã€ç‡‰èœã€‚", supermarkets: ["ç›§æ¯”å®‰ç´ï¼Œç´„6é–“"], wholesalers: ["Asia Food Slovenia"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [20, 40], "äºæ´²è‡ªåŠ©é¤": [5, 15], "æ—¥æœ¬é¤": [10, 20], "æ³°åœ‹é¤": [5, 15], "è¶Šå—é¤": [2, 5], "å…¶ä»–": [5, 10] } },
            { country: "æ„›æ²™å°¼äº", totalPop: 1.33, immigrantPop: 0.01, immigrantRatio: 1.0, sources: "ä¸­åœ‹ (0.3%), å°åº¦/å­ŸåŠ æ‹‰ (0.3%), å…¶ä»– (0.4%), å°ç£(<0.05%)", characteristics: "æ³¢ç¾…çš„æµ·åœ‹å®¶ï¼Œç§‘æŠ€ç™¼å±•ï¼›é£²é£Ÿä»¥é»‘éºµåŒ…å’Œè±¬è‚‰ç‚ºä¸»ï¼Œå¦‚è¡€è…¸ã€‚", supermarkets: ["å¡”æ—ï¼Œ5â€“6é–“"], wholesalers: ["A&A Asian Food Store (æ‰¹ç™¼æœå‹™)"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [20, 40], "äºæ´²è‡ªåŠ©é¤": [5, 15], "æ—¥æœ¬é¤": [10, 20], "æ³°åœ‹é¤": [5, 15], "è¶Šå—é¤": [2, 5], "å…¶ä»–": [5, 10] } },
            { country: "ç«‹é™¶å®›", totalPop: 2.83, immigrantPop: 0.02, immigrantRatio: 0.7, sources: "ä¸­åœ‹ (0.3%), å°åº¦ (0.2%), å…¶ä»– (0.2%), å°ç£(<0.05%)", characteristics: "æ³¢ç¾…çš„æµ·åœ‹å®¶ï¼›é£²é£Ÿä»¥é¦¬éˆ´è–¯å’Œè‚‰é¡ç‚ºä¸»ï¼Œå¦‚é¦¬éˆ´è–¯é¤ƒå­ã€‚", supermarkets: ["ç¶­çˆ¾ç´æ–¯ï¼Œç´„6é–“"], wholesalers: ["Oriental Food Lithuania"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [20, 40], "äºæ´²è‡ªåŠ©é¤": [5, 15], "æ—¥æœ¬é¤": [10, 20], "æ³°åœ‹é¤": [5, 15], "è¶Šå—é¤": [2, 5], "å…¶ä»–": [5, 10] } },
            { country: "æ‹‰è„«ç¶­äº", totalPop: 1.89, immigrantPop: 0.01, immigrantRatio: 0.6, sources: "ä¸­åœ‹ (0.2%), è¶Šå— (0.2%), å…¶ä»– (0.2%), å°ç£(<0.05%)", characteristics: "æ³¢ç¾…çš„æµ·åœ‹å®¶ï¼›é£²é£Ÿä»¥é»‘éºµåŒ…å’Œä¹³è£½å“ç‚ºä¸»ï¼Œå¦‚æ‹‰è„«ç¶­äºé»‘éºµåŒ…ã€‚", supermarkets: ["é‡ŒåŠ ï¼Œç´„5é–“"], wholesalers: ["SIA Cesars"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [20, 40], "äºæ´²è‡ªåŠ©é¤": [5, 15], "æ—¥æœ¬é¤": [10, 20], "æ³°åœ‹é¤": [5, 15], "è¶Šå—é¤": [2, 5], "å…¶ä»–": [5, 10] } },
            { country: "å…‹ç¾…åŸƒè¥¿äº", totalPop: 3.87, immigrantPop: 0.02, immigrantRatio: 0.6, sources: "ä¸­åœ‹ (0.2%), è²å¾‹è³“ (0.2%), å…¶ä»– (0.2%), å°ç£(<0.05%)", characteristics: "å—æ­ï¼Œè§€å…‰æ¥­ä¸»å°ï¼›é£²é£Ÿä»¥æµ·é®®å’Œåœ°ä¸­æµ·é¢¨å‘³ç‚ºä¸»ï¼Œå¦‚Pekaã€‚", supermarkets: ["æœ­æ ¼ç‘å¸ƒï¼Œç´„7é–“"], wholesalers: ["Panasia"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [20, 40], "äºæ´²è‡ªåŠ©é¤": [5, 15], "æ—¥æœ¬é¤": [10, 20], "æ³°åœ‹é¤": [5, 15], "è¶Šå—é¤": [2, 5], "å…¶ä»–": [5, 10] } },
            { country: "ä¿åŠ åˆ©äº", totalPop: 6.46, immigrantPop: 0.04, immigrantRatio: 0.6, sources: "ä¸­åœ‹ (0.2%), è¶Šå—/å…¶ä»– (0.4%), å°ç£(<0.05%)", characteristics: "æ±å—æ­ï¼Œå·¥æ¥­è½‰å‹ï¼›é£²é£Ÿä»¥ä¹³è£½å“å’Œè”¬èœç‚ºä¸»ï¼Œå¦‚ä¿åŠ åˆ©äºå„ªæ ¼ã€‚", supermarkets: ["ç´¢éäºï¼Œç´„8é–“"], wholesalers: ["Asia Food Bulgaria"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [30, 60], "äºæ´²è‡ªåŠ©é¤": [10, 20], "æ—¥æœ¬é¤": [20, 40], "æ³°åœ‹é¤": [10, 20], "è¶Šå—é¤": [5, 10], "å…¶ä»–": [10, 20] } },
            { country: "ç¾…é¦¬å°¼äº", totalPop: 19.24, immigrantPop: 0.10, immigrantRatio: 0.5, sources: "ä¸­åœ‹ (0.2%), åœŸè€³å…¶* (0.1%), å…¶ä»– (0.2%), å°ç£(<0.05%)", characteristics: "æ±æ­ï¼Œäºæ´²äººå£ç¨€å°‘ï¼›é£²é£Ÿä»¥ç‰ç±³ç²¥å’Œç‡‰è‚‰ç‚ºä¸»ï¼Œå¦‚è–©çˆ¾é¦¬ã€‚", supermarkets: ["å¸ƒåŠ å‹’æ–¯ç‰¹ï¼Œç´„14é–“"], wholesalers: ["Asia Food Romania"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [80, 150], "äºæ´²è‡ªåŠ©é¤": [20, 40], "æ—¥æœ¬é¤": [50, 100], "æ³°åœ‹é¤": [30, 60], "è¶Šå—é¤": [10, 20], "å…¶ä»–": [20, 40] } },
            { country: "æ–¯æ´›ä¼å…‹", totalPop: 5.43, immigrantPop: 0.03, immigrantRatio: 0.5, sources: "è¶Šå— (0.3%), ä¸­åœ‹ (0.1%), å…¶ä»– (0.1%), å°ç£(<0.05%)", characteristics: "ä¸­æ­ï¼Œå°å‹ç§»æ°‘ç¾¤é«”ï¼›é£²é£Ÿä»¥é¦¬éˆ´è–¯å’Œä¹³é…ªç‚ºä¸»ï¼Œå¦‚ç¾Šå¥¶é…ªéºµç–™ç˜©ã€‚", supermarkets: ["å¸ƒæ‹‰ææ–¯æ‹‰ç“¦ï¼Œç´„6é–“"], wholesalers: ["Asia Food Slovakia"], totalWholesalers: 2, restaurants: { "ä¸­é¤": [30, 60], "äºæ´²è‡ªåŠ©é¤": [10, 20], "æ—¥æœ¬é¤": [20, 40], "æ³°åœ‹é¤": [10, 20], "è¶Šå—é¤": [10, 20], "å…¶ä»–": [10, 20] } }
            ,
            { country: "è‹±åœ‹ (éæ­ç›Ÿ)", totalPop: 67.6, immigrantPop: 5.76, immigrantRatio: 8.6, sources: "å°åº¦ (2.9%), å·´åŸºæ–¯å¦ (2.5%), å­ŸåŠ æ‹‰ (1.0%), ä¸­åœ‹ (0.8%), å…¶ä»– (1.5%), å°ç£(<0.01%)", characteristics: "è¥¿æ­ï¼Œå¤šå…ƒæ–‡åŒ–ä¸­å¿ƒï¼›é£²é£Ÿä»¥ç‚¸é­šè–¯æ¢ã€çƒ¤è‚‰å’Œè‹±å¼æ—©é¤ç‚ºä¸»ã€‚", supermarkets: [
                "Oseyo (æœ€å¤§éŸ“äºé€£é–, ç´„14+é–“åˆ†åº—)",
                "WingYip(æ¦®æ¥­è¡Œ)",
                "Tian Tian Market (å€«æ•¦å¤šå®¶)",
                "Seoul Plaza (å€«æ•¦åŠå…¶ä»–åŸå¸‚æœ‰åˆ†åº—)",
                "å€«æ•¦ï¼Œç´„100-150é–“",
                "æ›¼å¾¹æ–¯ç‰¹ï¼Œç´„20-30é–“",
                "ä¼¯æ˜ç½•ï¼Œç´„15-25é–“"
            ], wholesalers: ["JFC (UK)", "JF Foods(è¦‹åº·é£Ÿå“)", "Manning Impex"], totalWholesalers: 40, manualSupermarketCount: 200, restaurants: { "ä¸­é¤": [4000, 6000], "äºæ´²è‡ªåŠ©é¤": [1000, 1500], "æ—¥æœ¬é¤": [1500, 2500], "æ³°åœ‹é¤": [800, 1200], "è¶Šå—é¤": [300, 500], "å°åº¦é¤": [8000, 10000], "å·´åŸºæ–¯å¦é¤": [3000, 4000], "è²å¾‹è³“é¤": [100, 200], "å…¶ä»–": [1000, 1500] } }
        ];

        let immigrantOriginChart, restaurantChart, comparisonChart, supermarketComparisonChart, restaurantComparisonChart, wholesalerComparisonChart;
        
        const chartColors = {
            primary: 'rgba(79, 70, 229, 0.8)',
            primaryBg: 'rgba(79, 70, 229, 0.1)',
            secondary: 'rgba(147, 51, 234, 0.8)',
            secondaryBg: 'rgba(147, 51, 234, 0.1)',
            accent: 'rgba(217, 70, 239, 0.8)', // ç”¨æ–¼è‹±åœ‹æ•¸æ“šçš„å¼·èª¿è‰²
            accentBg: 'rgba(217, 70, 239, 0.1)',
            neutral: 'rgba(100, 116, 139, 0.8)',
            neutralBg: 'rgba(100, 116, 139, 0.1)',
        };
        
        // ç”¨æ–¼ç§»æ°‘ä¾†æºå’Œå–®ä¸€åœ‹å®¶é¤å»³åœ–è¡¨çš„èª¿è‰²ç›¤ (ä¿æŒåŸæœ‰é¢¨æ ¼)
        const palette = [chartColors.primary, chartColors.secondary, chartColors.accent, '#7dd3fc', '#facc15', '#fb923c', '#4ade80'];

        // ç‚ºã€Œå„åœ‹äºæ´²é¤å»³æ•¸é‡ç¸½è¦½ã€åœ–è¡¨å®šç¾©ä¸€å€‹æ–°çš„ç¶ è‰²ç³»èª¿è‰²ç›¤ï¼Œåªç”¨æ–¼å–®è‰²èª¿
        const restaurantComparisonThemeColor = '#059669'; // Emerald 700 ä½œç‚ºå–®ä¸€ä¸»é¡Œè‰²

        // ç‚ºã€Œå„åœ‹äºæ´²é£Ÿå“æ‰¹ç™¼ç¸½æ•¸ã€åœ–è¡¨å®šç¾©ä¸€å€‹æ–°çš„è—è‰²ç³»èª¿è‰²ç›¤
        const wholesalerComparisonThemeColor = '#3b82f6'; // Blue 500 ä½œç‚ºå–®ä¸€ä¸»é¡Œè‰²

        // ç‚ºã€Œå„åœ‹äºæ´²è¶…å¸‚æ•¸é‡ç¸½è¦½ã€åœ–è¡¨å®šç¾©ä¸€å€‹æ–°çš„ä¸»é¡Œè‰² (ä¾‹å¦‚ï¼šæ©˜è‰²ç³»)
        const supermarketComparisonThemeColor = '#f97316'; // Orange 500 ä½œç‚ºå–®ä¸€ä¸»é¡Œè‰²


        /**
         * è§£æä¾†æºå­—ä¸²ï¼Œæå–æ¨™ç±¤å’Œæ•¸å€¼ã€‚
         * @param {string} sourceStr - ä¾†æºå­—ä¸²ï¼Œä¾‹å¦‚ "åœŸè€³å…¶ (2.1%), ä¸­åœ‹ (1.2%)"
         * @returns {object} åŒ…å«æ¨™ç±¤å’Œæ•¸å€¼çš„ç‰©ä»¶ { labels: [], values: [] }
         */
        function parseSourceString(sourceStr) {
            const sources = sourceStr.split(', ').map(s => s.trim());
            const data = { labels: [], values: [] };
            sources.forEach(source => {
                const match = source.match(/(.+?)\s?\((\S+?)(%?)\)/);
                if (match) {
                    const label = match[1].trim();
                    let value = parseFloat(match[2].replace('<', '')); // å¾ <0.05% ä¸­æå– 0.05
                    if(!isNaN(value)) {
                       data.labels.push(label);
                       data.values.push(value);
                    }
                }
            });
            return data;
        }
        
        /**
         * è¨ˆç®—æ•¸å€¼ç¯„åœçš„å¹³å‡å€¼ã€‚
         * @param {number[]} range - æ•¸å€¼ç¯„åœé™£åˆ— [min, max]
         * @returns {number} å¹³å‡å€¼
         */
        function getAverage(range) {
            if (!range || range.length !== 2) return 0;
            return (range[0] + range[1]) / 2;
        }

        /**
         * ä¼°è¨ˆå„åœ‹äºæ´²è¶…å¸‚çš„ç¸½æ•¸é‡ã€‚
         * @param {string[]} supermarketsArray - åŒ…å«è¶…å¸‚è³‡è¨Šçš„å­—ä¸²é™£åˆ—ã€‚
         * @returns {number} ä¼°è¨ˆçš„è¶…å¸‚ç¸½æ•¸ã€‚
         */
        function getEstimatedSupermarketCount(supermarketsArray) {
            let total = 0;
            supermarketsArray.forEach(item => {
                // å˜—è©¦åŒ¹é… "ç´„Xé–“é–€å¸‚" æˆ– "ç´„Xé–“" æˆ– "Xé–“åˆ†åº—"
                let match = item.match(/ç´„(\d+)\+?é–“(?:é–€å¸‚|åˆ†åº—)?/);
                if (!match) {
                    match = item.match(/(\d+)\+?é–“(?:é–€å¸‚|åˆ†åº—)?/);
                }
                if (!match) {
                    // å˜—è©¦åŒ¹é… "åŸå¸‚ï¼Œç´„Xé–“"
                    match = item.match(/ï¼Œç´„(\d+)\+?é–“/);
                }
                if (!match) {
                    // å˜—è©¦åŒ¹é… "åŸå¸‚ï¼ŒXé–“"
                    match = item.match(/ï¼Œ(\d+)\+?é–“/);
                }
                
                if (match && !isNaN(parseInt(match[1]))) {
                    total += parseInt(match[1]);
                }
                // å°æ–¼æ²’æœ‰æ˜ç¢ºæ•¸å­—çš„é€£é–åº—åç¨±ï¼Œå¦‚æœè©²åœ‹å®¶æ²’æœ‰å…¶ä»–æ˜ç¢ºæ•¸å­—ï¼Œå¯èƒ½éœ€è¦é¡å¤–è™•ç†
                // ä½†ç›®å‰æ•¸æ“šé›†ä¸­ï¼Œå¤§å¤šæ•¸æœ‰æ„ç¾©çš„è¨ˆæ•¸éƒ½æœ‰æ•¸å­—ï¼Œæ‰€ä»¥æš«æ™‚åªç´¯è¨ˆæ˜ç¢ºæ•¸å­—
            });
            return total;
        }

        /**
         * æ›´æ–°å„€è¡¨æ¿ä¸­é¸å®šåœ‹å®¶çš„è³‡è¨Šå’Œåœ–è¡¨ã€‚
         * @param {string} countryName - åœ‹å®¶åç¨±
         */
        function updateDashboard(countryName) {
            const data = reportData.find(c => c.country === countryName);
            if (!data) return;

            const profileContent = document.getElementById('profile-content');
            profileContent.innerHTML = `
                <p><strong>ç¸½äººå£ï¼š</strong>${data.totalPop} ç™¾è¬</p>
                <p><strong>äºæ´²ç§»æ°‘æ•¸é‡ï¼šï¼š</strong>â‰ˆ${data.immigrantPop} ç™¾è¬</p>
                <p><strong>äºæ´²ç§»æ°‘æ¯”ä¾‹ï¼šï¼š</strong>â‰ˆ${data.immigrantRatio}%</p>
                <p><strong>åœ°å€ç‰¹å¾µèˆ‡é£²é£Ÿç‰¹è‰²ï¼šï¼š</strong>${data.characteristics}</p>
            `;

            const supermarketContent = document.getElementById('supermarket-content');
            let supermarketHtml = `<ul class="list-disc list-inside text-slate-700 space-y-1">`;
            supermarketHtml += `<li><strong>ä¸»æµäºè¶…/ä¸»è¦åŸå¸‚æ•¸é‡:</strong></li>`;
            supermarketHtml += data.supermarkets.map(item => `<li>${item}</li>`).join('');
            supermarketHtml += `<li><strong>ç•¶åœ°å¤§å‹äºæ´²é£Ÿå“æ‰¹ç™¼å•†:</strong></li>`;
            supermarketHtml += data.wholesalers.map(item => `<li>${item}</li>`).join('');
            supermarketHtml += `<li><strong>ä¼°è¨ˆæ‰¹ç™¼å•†ç¸½æ•¸:</strong> ç´„ ${data.totalWholesalers} é–“</li>`;
            supermarketHtml += `</ul>`;
            supermarketContent.innerHTML = supermarketHtml;


            const sourceData = parseSourceString(data.sources);
            if (immigrantOriginChart) immigrantOriginChart.destroy();
            immigrantOriginChart = new Chart(document.getElementById('immigrant-origin-chart').getContext('2d'), {
                type: 'doughnut',
                data: {
                    labels: sourceData.labels,
                    datasets: [{
                        label: 'ç§»æ°‘ä¸»è¦ä¾†æºåœ‹ä½”æ¯”',
                        data: sourceData.values,
                        backgroundColor: palette,
                        borderColor: '#f8fafc',
                        borderWidth: 4,
                        hoverOffset: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            position: 'bottom', 
                            labels: { 
                                font: { size: 12 },
                                // è‡ªè¨‚æ¨™ç±¤ç”Ÿæˆä»¥åœ¨åœ–ä¾‹ä¸­åŒ…å«ç™¾åˆ†æ¯”
                                generateLabels: function(chart) {
                                    const data = chart.data;
                                    if (data.labels.length && data.datasets.length) {
                                        return data.labels.map(function(label, i) {
                                            const value = data.datasets[0].data[i];
                                            return {
                                                text: `${label}: ${value}%`, // é¡¯ç¤ºæ¨™ç±¤åŠå…¶ç™¾åˆ†æ¯”å€¼
                                                fillStyle: data.datasets[0].backgroundColor[i],
                                                strokeStyle: data.datasets[0].borderColor[i],
                                                lineWidth: data.datasets[0].borderWidth,
                                                hidden: !chart.isDatasetVisible(0) || data.datasets[0].hidden,
                                                index: i
                                            };
                                        });
                                    }
                                    return [];
                                }
                            } 
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    cutout: '60%'
                }
            });

            const restaurantData = data.restaurants;
            const restaurantLabels = Object.keys(restaurantData);
            const restaurantValues = restaurantLabels.map(label => getAverage(restaurantData[label]));
            
            if (restaurantChart) restaurantChart.destroy();
            restaurantChart = new Chart(document.getElementById('restaurant-chart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: restaurantLabels,
                    datasets: [{
                        label: 'é¤å»³å¹³å‡æ•¸é‡',
                        data: restaurantValues,
                        backgroundColor: palette.map((color, i) => color.replace('0.8', '0.6')),
                        borderColor: palette,
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(203, 213, 225, 0.3)'
                            }
                        },
                        y: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                             callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const originalRange = restaurantData[label];
                                    return `${label}: ç´„ ${originalRange[0]} ~ ${originalRange[1]} é–“`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        /**
         * åˆå§‹åŒ–å„åœ‹äºæ´²ç§»æ°‘æ¯”ä¾‹ç¸½è¦½çš„æŸ±ç‹€åœ–ã€‚
         */
        function initializeComparisonChart() {
            // Filter out UK data
            const ukData = reportData.find(c => c.country.includes('è‹±åœ‹'));
            const otherCountries = reportData.filter(c => !c.country.includes('è‹±åœ‹'));

            // Sort other countries by immigrant ratio in descending order
            const sortedOtherCountries = [...otherCountries].sort((a, b) => b.immigrantRatio - a.immigrantRatio);

            // Combine sorted other countries with UK at the end
            const finalSortedData = ukData ? [...sortedOtherCountries, ukData] : sortedOtherCountries;

            const labels = finalSortedData.map(d => d.country);
            const values = finalSortedData.map(d => d.immigrantRatio);
            
            if (comparisonChart) comparisonChart.destroy(); // Destroy existing chart if it exists
            comparisonChart = new Chart(document.getElementById('comparison-chart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'äºæ´²ç§»æ°‘æ¯”ä¾‹ (%)',
                        data: values,
                        backgroundColor: (context) => {
                            // Check if the label contains "è‹±åœ‹"
                            return context.chart.data.labels[context.dataIndex].includes('è‹±åœ‹') ? chartColors.accent : chartColors.primaryBg;
                        },
                        borderColor: (context) => {
                            // Check if the label contains "è‹±åœ‹"
                            return context.chart.data.labels[context.dataIndex].includes('è‹±åœ‹') ? chartColors.accent : chartColors.primary;
                        },
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ç§»æ°‘ä½”ç¸½äººå£æ¯”ä¾‹ (%)'
                            },
                             grid: {
                                color: 'rgba(203, 213, 225, 0.3)'
                            }
                        },
                        x: {
                             grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        /**
         * åˆå§‹åŒ–å„åœ‹äºæ´²è¶…å¸‚æ•¸é‡ç¸½è¦½çš„æŸ±ç‹€åœ–ã€‚
         */
        function initializeSupermarketComparisonChart() {
            const ukData = reportData.find(c => c.country.includes('è‹±åœ‹'));
            const otherCountries = reportData.filter(c => !c.country.includes('è‹±åœ‹'));

            const supermarketTotalsForSorting = otherCountries.map(country => {
                return {
                    country: country.country,
                    // ä½¿ç”¨ manualSupermarketCount å¦‚æœå­˜åœ¨ï¼Œå¦å‰‡ä½¿ç”¨ getEstimatedSupermarketCount
                    totalSupermarkets: country.manualSupermarketCount !== undefined ? country.manualSupermarketCount : getEstimatedSupermarketCount(country.supermarkets)
                };
            });

            const sortedSupermarketData = [...supermarketTotalsForSorting].sort((a, b) => b.totalSupermarkets - a.totalSupermarkets);

            if (ukData) {
                sortedSupermarketData.push({
                    country: ukData.country,
                    // ä½¿ç”¨ manualSupermarketCount å¦‚æœå­˜åœ¨ï¼Œå¦å‰‡ä½¿ç”¨ getEstimatedSupermarketCount
                    totalSupermarkets: ukData.manualSupermarketCount !== undefined ? ukData.manualSupermarketCount : getEstimatedSupermarketCount(ukData.supermarkets)
                });
            }

            const labels = sortedSupermarketData.map(d => d.country);
            const values = sortedSupermarketData.map(d => d.totalSupermarkets);

            if (supermarketComparisonChart) supermarketComparisonChart.destroy();
            supermarketComparisonChart = new Chart(document.getElementById('supermarket-comparison-chart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'äºæ´²è¶…å¸‚ç¸½æ•¸é‡ (ä¼°è¨ˆ)',
                        data: values,
                        backgroundColor: (context) => {
                            return context.chart.data.labels[context.dataIndex].includes('è‹±åœ‹') ? chartColors.accent : supermarketComparisonThemeColor;
                        },
                        borderColor: (context) => {
                            return context.chart.data.labels[context.dataIndex].includes('è‹±åœ‹') ? chartColors.accent : supermarketComparisonThemeColor;
                        },
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = Math.round(context.raw);
                                    return `${label}: ç´„ ${value} é–“`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'äºæ´²è¶…å¸‚ç¸½æ•¸é‡ (ä¼°è¨ˆ)'
                            },
                            grid: {
                                color: 'rgba(203, 213, 225, 0.3)'
                            }
                        }
                    }
                }
            });
        }


        /**
         * åˆå§‹åŒ–å„åœ‹äºæ´²é¤å»³æ•¸é‡ç¸½è¦½çš„æŸ±ç‹€åœ–ï¼ˆéå †ç–Šï¼‰ï¼Œä¸¦ä½¿ç”¨å–®ä¸€ä¸»é¡Œé¡è‰²ã€‚
         */
        function initializeRestaurantComparisonChart() {
            // éæ¿¾å‡ºè‹±åœ‹æ•¸æ“š
            const ukData = reportData.find(c => c.country.includes('è‹±åœ‹'));
            const otherCountries = reportData.filter(c => !c.country.includes('è‹±åœ‹'));

            // è¨ˆç®—æ¯å€‹åœ‹å®¶çš„äºæ´²é¤å»³ç¸½å¹³å‡æ•¸é‡ä¸¦ç‚ºæ’åºæº–å‚™
            const restaurantTotalsForSorting = otherCountries.map(country => {
                let totalAverage = 0;
                for (const cuisine in country.restaurants) {
                    totalAverage += getAverage(country.restaurants[cuisine]);
                }
                return {
                    country: country.country,
                    totalRestaurants: totalAverage
                };
            });

            // å…¶ä»–åœ‹å®¶ä¾é¤å»³ç¸½æ•¸é™åºæ’åº
            const sortedRestaurantData = [...restaurantTotalsForSorting].sort((a, b) => b.totalRestaurants - a.totalRestaurants);

            // å¦‚æœæœ‰è‹±åœ‹æ•¸æ“šï¼Œè¨ˆç®—å…¶ç¸½å¹³å‡æ•¸é‡ä¸¦ç½®æ–¼æœ«å°¾
            if (ukData) {
                let ukTotalAverage = 0;
                for (const cuisine in ukData.restaurants) {
                    ukTotalAverage += getAverage(ukData.restaurants[cuisine]);
                }
                sortedRestaurantData.push({
                    country: ukData.country,
                    totalRestaurants: ukTotalAverage
                });
            }

            const labels = sortedRestaurantData.map(d => d.country);
            const values = sortedRestaurantData.map(d => d.totalRestaurants);
            
            if (restaurantComparisonChart) restaurantComparisonChart.destroy(); // å¦‚æœåœ–è¡¨å·²å­˜åœ¨å‰‡éŠ·æ¯€
            restaurantComparisonChart = new Chart(document.getElementById('restaurant-comparison-chart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'äºæ´²é¤å»³ç¸½æ•¸é‡ (ä¼°è¨ˆ)',
                        data: values,
                        backgroundColor: (context) => {
                            // æª¢æŸ¥æ¨™ç±¤æ˜¯å¦åŒ…å« "è‹±åœ‹"ï¼Œä¸¦ä½¿ç”¨ä¸»é¡Œè‰²æˆ–å¼·èª¿è‰²
                            return context.chart.data.labels[context.dataIndex].includes('è‹±åœ‹') ? chartColors.accent : restaurantComparisonThemeColor;
                        },
                        borderColor: (context) => {
                            // æª¢æŸ¥æ¨™ç±¤æ˜¯å¦åŒ…å« "è‹±åœ‹"ï¼Œä¸¦ä½¿ç”¨ä¸»é¡Œè‰²æˆ–å¼·èª¿è‰²
                            return context.chart.data.labels[context.dataIndex].includes('è‹±åœ‹') ? chartColors.accent : restaurantComparisonThemeColor;
                        },
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }, // å–®ä¸€æŸ±ç‹€åœ–ä¸éœ€è¦åœ–ä¾‹
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = Math.round(context.raw);
                                    return `${label}: ç´„ ${value} é–“`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            stacked: false, // ä¸å †ç–Š
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            stacked: false, // ä¸å †ç–Š
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'äºæ´²é¤å»³ç¸½æ•¸é‡ (ä¼°è¨ˆ)'
                            },
                             grid: {
                                color: 'rgba(203, 213, 225, 0.3)'
                            }
                        }
                    }
                }
            });
        }

        /**
         * åˆå§‹åŒ–å„åœ‹äºæ´²é£Ÿå“æ‰¹ç™¼ç¸½æ•¸çš„æŸ±ç‹€åœ–ã€‚
         */
        function initializeWholesalerComparisonChart() {
            const ukData = reportData.find(c => c.country.includes('è‹±åœ‹'));
            const otherCountries = reportData.filter(c => !c.country.includes('è‹±åœ‹'));

            const sortedWholesalerData = [...otherCountries].sort((a, b) => b.totalWholesalers - a.totalWholesalers);

            if (ukData) {
                sortedWholesalerData.push(ukData);
            }

            const labels = sortedWholesalerData.map(d => d.country);
            const values = sortedWholesalerData.map(d => d.totalWholesalers);

            if (wholesalerComparisonChart) wholesalerComparisonChart.destroy();
            wholesalerComparisonChart = new Chart(document.getElementById('wholesaler-comparison-chart').getContext('2d'), {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'äºæ´²é£Ÿå“æ‰¹ç™¼ç¸½æ•¸ (ä¼°è¨ˆ)',
                        data: values,
                        backgroundColor: (context) => {
                            return context.chart.data.labels[context.dataIndex].includes('è‹±åœ‹') ? chartColors.accent : wholesalerComparisonThemeColor;
                        },
                        borderColor: (context) => {
                            return context.chart.data.labels[context.dataIndex].includes('è‹±åœ‹') ? chartColors.accent : wholesalerComparisonThemeColor;
                        },
                        borderWidth: 2,
                        borderRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = Math.round(context.raw);
                                    return `${label}: ç´„ ${value} é–“`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'äºæ´²é£Ÿå“æ‰¹ç™¼ç¸½æ•¸ (ä¼°è¨ˆ)'
                            },
                            grid: {
                                color: 'rgba(203, 213, 225, 0.3)'
                            }
                        }
                    }
                }
            });
        }


        document.addEventListener('DOMContentLoaded', () => {
            const selector = document.getElementById('country-selector');
            
            // å°‡è‹±åœ‹æ•¸æ“šå¾å…¶é¤˜æ•¸æ“šä¸­åˆ†é›¢ï¼Œç”¨æ–¼ä¸‹æ‹‰é¸å–®æ’åº
            const ukDataForSelector = reportData.find(c => c.country.includes('è‹±åœ‹'));
            const otherCountriesForSelector = reportData.filter(c => !c.country.includes('è‹±åœ‹'));

            // å…¶ä»–åœ‹å®¶ä¾ç§»æ°‘æ•¸é‡é™åºæ’åº
            const sortedOtherCountriesForSelector = [...otherCountriesForSelector].sort((a, b) => b.immigrantPop - a.immigrantPop);

            // å°‡æ’åºå¾Œçš„å…¶ä»–åœ‹å®¶èˆ‡è‹±åœ‹æ•¸æ“šåˆä½µï¼Œè‹±åœ‹æ•¸æ“šç½®æ–¼æœ«å°¾ä»¥ç”¨æ–¼ä¸‹æ‹‰é¸å–®
            const finalSortedDataForSelector = ukDataForSelector ? [...sortedOtherCountriesForSelector, ukDataForSelector] : sortedOtherCountriesForSelector;


            finalSortedDataForSelector.forEach(c => {
                const option = document.createElement('option');
                option.value = c.country;
                option.textContent = c.country;
                selector.appendChild(option);
            });

            selector.addEventListener('change', (e) => {
                updateDashboard(e.target.value);
            });
            
            // é è¨­é¸ä¸­å¾·åœ‹
            selector.value = 'å¾·åœ‹';
            updateDashboard('å¾·åœ‹');
            initializeComparisonChart();
            initializeSupermarketComparisonChart(); // åˆå§‹åŒ–æ–°çš„è¶…å¸‚æ•¸é‡ç¸½è¦½åœ–è¡¨
            initializeRestaurantComparisonChart(); // åˆå§‹åŒ–é¤å»³æ•¸é‡ç¸½è¦½åœ–è¡¨
            initializeWholesalerComparisonChart(); // åˆå§‹åŒ–æ‰¹ç™¼å•†æ•¸é‡ç¸½è¦½åœ–è¡¨
        });

    </script>

</body>
</html>
